!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=t():"object"==typeof define?define(t):t(!0)}(window,function(e){"use strict";function t(e){var t={storage:"localStorage",exp:c(a),baseTime:c(),crypt:"base64"};this._saveDataWithHandleError=function(e,t){try{this.storage.setItem(e,t)}catch(r){if(!v(r))throw r;this.deleteAllExp();try{this.storage.setItem(e,t)}catch(e){throw e}}},n=f(t,e),r=n.baseTime,this.storage=function(e){return window[e]instanceof Storage?window[e]:null}(n.storage)}var r,n,o=function(){var e=function(e){this.message=e};e.prototype=new Error,e.prototype.name="InvalidCharacterError";var t=function(t){throw new e(t)},r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=function(e){e=String(e).replace(/[\t\n\f\r ]/g,"");var n=e.length;n%4==0&&(e=e.replace(/==?$/,""),n=e.length),(n%4==1||/[^+a-zA-Z0-9\/]/.test(e))&&t("Invalid character: the string to be decoded is not correctly encoded.");for(var o,a,i=0,c="",s=-1;++s<n;)a=r.indexOf(e.charAt(s)),o=i%4?64*o+a:a,i++%4&&(c+=String.fromCharCode(255&o>>(-2*i&6)));return c};return{encode:function(e){e=String(e),/[^\0-\xFF]/.test(e)&&t("The string to be encoded contains characters outside of the Latin1 range.");for(var n,o,a,i,c=e.length%3,s="",u=-1,f=e.length-c;++u<f;)n=e.charCodeAt(u)<<16,o=e.charCodeAt(++u)<<8,a=e.charCodeAt(++u),i=n+o+a,s+=r.charAt(i>>18&63)+r.charAt(i>>12&63)+r.charAt(i>>6&63)+r.charAt(63&i);return 2==c?(n=e.charCodeAt(u)<<8,o=e.charCodeAt(++u),i=n+o,s+=r.charAt(i>>10)+r.charAt(i>>4&63)+r.charAt(i<<2&63)+"="):1==c&&(i=e.charCodeAt(u),s+=r.charAt(i>>2)+r.charAt(i<<4&63)+"=="),s},decode:n,version:"0.1.0"}}(),a="Fri, 31 Dec 9999 23:59:59 UTC",i=function(e){var t={};for(var r in e)t[r]=e[r];return t},c=function(e){if(e)var t="function"==typeof e?e():new Date(e).valueOf();else var t=(new Date).valueOf();if(isNaN(t))throw new Error('argument "'+t+'" must be Number');return t},s=function(e,t){var r=c(t);if(isNaN(e))throw new Error('argument "'+e+'" must be Number');return r+parseInt(e)},u=function(e,t){return t?e<t:e<c()},f=function(e,t){if(!t)return e;var r=i(e);for(var n in t)r[n]=t[n];return e=null,r},d=function(e){return null===e?e:"object"==typeof e?JSON.stringify(e):e},h=function(e){if("string"!=typeof e)return e;try{return JSON.parse(e)}catch(t){return e}},l=function(e){switch(e){case"base64":return{encode:function(e){return o.encode(e)},decode:function(e){return o.decode(e)}};default:return{encode:function(e){return e},decode:function(e){return e}}}},g=function(e,t){var r={};return r.c=c(t.baseTime),r.e=t.exp,r.v=l(t.crypt).encode(d(e)),r};!function(e){try{var t=window.localStorage instanceof Storage,r=window.sessionStorage instanceof Storage;switch(e){case"localStorage":return t;case"sessionStorage":return r;default:t&&r}}catch(e){throw new Error("don't support Web Storage")}}();var v=function(e){var t=!1;if(e)if(e.code)switch(e.code){case 22:t=!0;break;case 1014:"NS_ERROR_DOM_QUOTA_REACHED"===e.name&&(t=!0)}else e.number===-2147024882&&(t=!0);return t},p={setItem:function(e,t,r){"string"!=typeof e&&(e=String(e)),r&&r.exp&&(r.exp=s(r.exp,n.baseTime)),r=f(n,r);var o=g(t,r);this._saveDataWithHandleError(e,d(o))},getItem:function(e){var t=this.storage.getItem(e);if(t&&h(t).v){t=h(t);if(u(t.e,t.c))return this.deleteItem(e),null;return h(l(n.crypt).decode(t.v))}return t},getAll:function(){var e={};for(var t in this.storage)e[t]=this.getItem(t);return e},updateItem:function(e,t,r){var o=this.storage.getItem(e);if(!o)return o;o=h(o),o.v=h(l(n.crypt).decode(o.v)),o.c=c(n.baseTime),r&&r.exp&&(o.e=s(r.exp,o.c)),o.v="object"!=typeof t||null===t?t:l(n.crypt).encode(d(f(o.v,t))),o=d(o),this._saveDataWithHandleError(e,o)},updateExp:function(e,t){var r=this.storage.getItem(e);if(r&&h(r).v)r=h(r),r.e=s(t,r.c),r=d(r),this._saveDataWithHandleError(e,r);else{if(!r||h(r).v)return r;this.setItem(e,r,t)}},deleteItem:function(e){this.storage.removeItem(e)},deleteAllExp:function(){for(var e in this.storage)this.getItem(e)},deleteAll:function(){this.storage.clear()}};return t.prototype=p,e&&(window.ExtendStorage=t),t});