!function(t,e){"object"==typeof module&&"object"==typeof module.exports?module.exports=e():"object"==typeof define?define(e):window.extendStorage=e()}(window,function(t){"use strict";function e(t){this.version=o;var e={storage:"localStorage",exp:i(c),baseTime:i(),crypt:"base64"};this._saveDataWithHandleError=function(t,e){try{this.storage.setItem(t,e)}catch(r){if(!p(r))throw r;this.deleteAllExp();try{this.storage.setItem(t,e)}catch(t){throw t}}},n=h(e,t),r=n.baseTime,this.storage=function(t){return window[t]instanceof Storage?window[t]:null}(n.storage)}var r,n,o="1.0.0",a=function(){var t;if("undefined"!=typeof module&&module.exports)try{t=require("buffer").Buffer}catch(t){}var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=function(t){for(var e={},r=0,n=t.length;r<n;r++)e[t.charAt(r)]=r;return e}(e),n=String.fromCharCode,o=function(t){if(t.length<2){var e=t.charCodeAt(0);return e<128?t:e<2048?n(192|e>>>6)+n(128|63&e):n(224|e>>>12&15)+n(128|e>>>6&63)+n(128|63&e)}var e=65536+1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320);return n(240|e>>>18&7)+n(128|e>>>12&63)+n(128|e>>>6&63)+n(128|63&e)},a=function(t){return t.replace(/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,o)},c=function(t){var r=[0,2,1][t.length%3],n=t.charCodeAt(0)<<16|(t.length>1?t.charCodeAt(1):0)<<8|(t.length>2?t.charCodeAt(2):0);return[e.charAt(n>>>18),e.charAt(n>>>12&63),r>=2?"=":e.charAt(n>>>6&63),r>=1?"=":e.charAt(63&n)].join("")},u=window.btoa?function(t){return window.btoa(t)}:function(t){return t.replace(/[\s\S]{1,3}/g,c)},i=t?function(e){return(e.constructor===t.constructor?e:new t(e)).toString("base64")}:function(t){return u(a(t))},f=function(t,e){return e?i(String(t)).replace(/[+\/]/g,function(t){return"+"==t?"-":"_"}).replace(/=/g,""):i(String(t))},s=function(t){return f(t,!0)},h=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),d=function(t){switch(t.length){case 4:var e=(7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3),r=e-65536;return n(55296+(r>>>10))+n(56320+(1023&r));case 3:return n((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return n((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},l=function(t){return t.replace(h,d)},g=function(t){var e=t.length,o=e%4,a=(e>0?r[t.charAt(0)]<<18:0)|(e>1?r[t.charAt(1)]<<12:0)|(e>2?r[t.charAt(2)]<<6:0)|(e>3?r[t.charAt(3)]:0),c=[n(a>>>16),n(a>>>8&255),n(255&a)];return c.length-=[0,0,2,1][o],c.join("")},v=window.atob?function(t){return window.atob(t)}:function(t){return t.replace(/[\s\S]{1,4}/g,g)},p=t?function(e){return(e.constructor===t.constructor?e:new t(e,"base64")).toString()}:function(t){return l(v(t))},m=function(t){return p(String(t).replace(/[-_]/g,function(t){return"-"==t?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))};return{VERSION:"2.1.9",atob:v,btoa:u,fromBase64:m,toBase64:f,utob:a,encode:f,encodeURI:s,btou:l,decode:m}}(),c="Fri, 31 Dec 9999 23:59:59 UTC",u=function(t){var e={};for(var r in t)e[r]=t[r];return e},i=function(t){var e;if(t)var e="function"==typeof t?t():new Date(t).valueOf();else var e=(new Date).valueOf();if(isNaN(e)){var r="function"==typeof t?e:t;throw new Error('argument "'+r+'" must be Number')}return e},f=function(t,e){var r=i(e);if(isNaN(t))throw new Error('argument "'+t+'" must be Number');return r+parseInt(t)},s=function(t,e){return e?t<e:t<i()},h=function(t,e){if(!e)return t;var r=u(t);for(var n in e)r[n]=e[n];return t=null,r},d=function(t){return null===t?t:"object"==typeof t?JSON.stringify(t):t},l=function(t){if("string"!=typeof t)return t;try{return JSON.parse(t)}catch(e){return t}},g=function(t){switch(t){case"base64":return{encode:function(t){try{return a.encode(t)}catch(e){return t}},decode:function(t){try{return a.decode(t)}catch(e){return t}}};default:return{encode:function(t){return t},decode:function(t){return t}}}},v=function(t,e){var r={};return r.c=i(e.baseTime),r.e=e.exp,r.v=g(e.crypt).encode(d(t)),r};!function(t){try{var e=window.localStorage instanceof Storage,r=window.sessionStorage instanceof Storage;switch(t){case"localStorage":return e;case"sessionStorage":return r;default:e&&r}}catch(t){throw new Error("don't support Web Storage")}}();var p=function(t){var e=!1;if(t)if(t.code)switch(t.code){case 22:e=!0;break;case 1014:"NS_ERROR_DOM_QUOTA_REACHED"===t.name&&(e=!0)}else t.number===-2147024882&&(e=!0);return e},m={setItem:function(t,e,r){"string"!=typeof t&&(t=String(t)),r&&r.exp&&(r.exp=f(r.exp,n.baseTime)),r=h(n,r);var o=v(e,r);this._saveDataWithHandleError(t,d(o))},getItem:function(t){var e=this.storage.getItem(t);if(e&&l(e).v){e=l(e);if(s(e.e,e.c))return this.deleteItem(t),null;return l(g(n.crypt).decode(e.v))}return e},getAll:function(){var t={};for(var e in this.storage)t[e]=this.getItem(e);return t},mergeItem:function(t,e,r){var o=this.storage.getItem(t);if(!o)return o;o=l(o),o.v=l(g(n.crypt).decode(o.v)),o.c=i(n.baseTime),r&&r.exp&&(o.e=f(r.exp,o.c)),o.v="object"!=typeof e||null===e?e:g(n.crypt).encode(d(h(o.v,e))),o=d(o),this._saveDataWithHandleError(t,o)},updateExp:function(t,e){var r=this.storage.getItem(t);if(r&&l(r).v)r=l(r),r.e=f(e,r.c),r=d(r),this._saveDataWithHandleError(t,r);else{if(!r||l(r).v)return r;this.setItem(t,r,e)}},removeItem:function(t){this.storage.removeItem(t)},clearAllExp:function(){for(var t in this.storage)this.getItem(t)},clear:function(){this.storage.clear()}};return e.prototype=m,e});