!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=t():"object"==typeof define?define(t):window.extendStorage=t()}(window,function(e){"use strict";function t(e){this.version=o;var t={storage:"localStorage",exp:s(c),baseTime:s(),crypt:"base64"};this._saveDataWithHandleError=function(e,t){try{this.storage.setItem(e,t)}catch(r){if(!p(r))throw r;this.deleteAllExp();try{this.storage.setItem(e,t)}catch(e){throw e}}},n=h(t,e),r=n.baseTime,this.storage=function(e){return window[e]instanceof Storage?window[e]:null}(n.storage)}var r,n,o="1.0.0",a=function(){var e=function(e){this.message=e};e.prototype=new Error,e.prototype.name="InvalidCharacterError";var t=function(t){throw new e(t)},r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=function(e){e=String(e).replace(/[\t\n\f\r ]/g,"");var n=e.length;n%4==0&&(e=e.replace(/==?$/,""),n=e.length),(n%4==1||/[^+a-zA-Z0-9\/]/.test(e))&&t("Invalid character: the string to be decoded is not correctly encoded.");for(var o,a,c=0,i="",s=-1;++s<n;)a=r.indexOf(e.charAt(s)),o=c%4?64*o+a:a,c++%4&&(i+=String.fromCharCode(255&o>>(-2*c&6)));return i};return{encode:function(e){e=String(e),/[^\0-\xFF]/.test(e)&&t("The string to be encoded contains characters outside of the Latin1 range.");for(var n,o,a,c,i=e.length%3,s="",u=-1,f=e.length-i;++u<f;)n=e.charCodeAt(u)<<16,o=e.charCodeAt(++u)<<8,a=e.charCodeAt(++u),c=n+o+a,s+=r.charAt(c>>18&63)+r.charAt(c>>12&63)+r.charAt(c>>6&63)+r.charAt(63&c);return 2==i?(n=e.charCodeAt(u)<<8,o=e.charCodeAt(++u),c=n+o,s+=r.charAt(c>>10)+r.charAt(c>>4&63)+r.charAt(c<<2&63)+"="):1==i&&(c=e.charCodeAt(u),s+=r.charAt(c>>2)+r.charAt(c<<4&63)+"=="),s},decode:n,version:"0.1.0"}}(),c="Fri, 31 Dec 9999 23:59:59 UTC",i=function(e){var t={};for(var r in e)t[r]=e[r];return t},s=function(e){var t;if(e)var t="function"==typeof e?e():new Date(e).valueOf();else var t=(new Date).valueOf();if(isNaN(t)){var r="function"==typeof e?t:e;throw new Error('argument "'+r+'" must be Number')}return t},u=function(e,t){var r=s(t);if(isNaN(e))throw new Error('argument "'+e+'" must be Number');return r+parseInt(e)},f=function(e,t){return t?e<t:e<s()},h=function(e,t){if(!t)return e;var r=i(e);for(var n in t)r[n]=t[n];return e=null,r},d=function(e){return null===e?e:"object"==typeof e?JSON.stringify(e):e},l=function(e){if("string"!=typeof e)return e;try{return JSON.parse(e)}catch(t){return e}},g=function(e){switch(e){case"base64":return{encode:function(e){return a.encode(e)},decode:function(e){return a.decode(e)}};default:return{encode:function(e){return e},decode:function(e){return e}}}},v=function(e,t){var r={};return r.c=s(t.baseTime),r.e=t.exp,r.v=g(t.crypt).encode(d(e)),r};!function(e){try{var t=window.localStorage instanceof Storage,r=window.sessionStorage instanceof Storage;switch(e){case"localStorage":return t;case"sessionStorage":return r;default:t&&r}}catch(e){throw new Error("don't support Web Storage")}}();var p=function(e){var t=!1;if(e)if(e.code)switch(e.code){case 22:t=!0;break;case 1014:"NS_ERROR_DOM_QUOTA_REACHED"===e.name&&(t=!0)}else e.number===-2147024882&&(t=!0);return t},m={setItem:function(e,t,r){"string"!=typeof e&&(e=String(e)),r&&r.exp&&(r.exp=u(r.exp,n.baseTime)),r=h(n,r);var o=v(t,r);this._saveDataWithHandleError(e,d(o))},getItem:function(e){var t=this.storage.getItem(e);if(!t||!l(t).v)return t;if(t=l(t),f(t.e,t.c))return this.deleteItem(e),null;try{return l(g(n.crypt).decode(t.v))}catch(e){return t}},getAll:function(){var e={};for(var t in this.storage)e[t]=this.getItem(t);return e},mergeItem:function(e,t,r){var o=this.storage.getItem(e);if(!o)return o;o=l(o),o.v=l(g(n.crypt).decode(o.v)),o.c=s(n.baseTime),r&&r.exp&&(o.e=u(r.exp,o.c)),o.v="object"!=typeof t||null===t?t:g(n.crypt).encode(d(h(o.v,t))),o=d(o),this._saveDataWithHandleError(e,o)},updateExp:function(e,t){var r=this.storage.getItem(e);if(r&&l(r).v)r=l(r),r.e=u(t,r.c),r=d(r),this._saveDataWithHandleError(e,r);else{if(!r||l(r).v)return r;this.setItem(e,r,t)}},clearItem:function(e){this.storage.removeItem(e)},clearAllExp:function(){for(var e in this.storage)this.getItem(e)},clearAll:function(){this.storage.clear()}};return t.prototype=m,t});